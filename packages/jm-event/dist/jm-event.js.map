{"version":3,"file":"jm-event.js","sources":["../lib/index.js"],"sourcesContent":["/**\n * event module.\n * @module event\n */\n\nasync function emitAsync (eventName, ...args) {\n  // using a copy to avoid error when listener array changed\n  let listeners = this.listeners(eventName)\n  for (let i = 0; i < listeners.length; i++) {\n    let fn = listeners[i]\n    let obj = fn(...args)\n    if (!!obj && (typeof obj === 'object' || typeof obj === 'function') && typeof obj.then === 'function') obj = await obj\n    if (obj !== undefined) return obj\n  }\n}\n\n/**\n * Class representing an eventEmitter.\n *\n * ```javascript\n * // es6\n * let eventEmitter = new EventEmitter();\n * eventEmitter.on('test', (info) => {\n *      console.log(info);\n * });\n * eventEmitter.once('test', (info) => {\n *      // this will be called only one time\n *      console.log(info);\n * });\n * eventEmitter.one('test', (info) => {\n *      // this will be called first\n *      console.log(info);\n * }, true);\n *\n * eventEmitter.emit('test', 'hello eventEmitter');\n * eventEmitter.off('test');\n * ```\n */\nclass EventEmitter {\n  /**\n   * Create an eventEmitter.\n   */\n  constructor (opts = {}) {\n    this._events = {}\n    if (opts.async) this.emit = emitAsync\n  }\n\n  /**\n   * Adds the listener function to the end of the listeners array for the event named eventName.\n   * No checks are made to see if the listener has already been added.\n   * Multiple calls passing the same combination of eventName and listener will result in the listener being added, and called, multiple times.\n   *\n   * @param {*} eventName - event name\n   * @param {Function} fn - listener function\n   * @param {boolean} [prepend] - Adds to the beginning of the listeners array if true\n   * @return {EventEmitter} - for chaining\n   */\n  on (eventName, fn, prepend) {\n    this._events[eventName] || (this._events[eventName] = [])\n    if (prepend) {\n      this._events[eventName].unshift(fn)\n    } else {\n      this._events[eventName].push(fn)\n    }\n    return this\n  }\n\n  /**\n   * Adds a one time listener function for the event named eventName.\n   * The next time eventName is triggered, this listener is removed and then invoked.\n   *\n   * @param {*} eventName - event name\n   * @param {Function} fn - listener function\n   * @param {boolean} [prepend] - Adds to the beginning of the listeners array if true\n   * @return {EventEmitter} - for chaining\n   */\n  once (eventName, fn, prepend) {\n    let on = (arg1, arg2, arg3, arg4, arg5) => {\n      this.off(eventName, on)\n      fn(arg1, arg2, arg3, arg4, arg5)\n    }\n    return this.on(eventName, on, prepend)\n  }\n\n  /**\n   * Removes a listener for the event named eventName.\n   * Removes all listeners from the listener array for event named eventName if fn is null\n   * Removes all listeners from the listener array if eventName is null\n   *\n   * @param {*} [eventName] - event name\n   * @param {Function} [fn] - listener function\n   * @return {EventEmitter} - for chaining\n   */\n  off (eventName, fn) {\n    if (!fn) {\n      if (eventName === undefined) {\n        this._events = {}\n      } else if (this._events && this._events[eventName]) {\n        delete this._events[eventName]\n      }\n    } else if (this._events && this._events[eventName]) {\n      let list = this._events[eventName]\n      for (let i = 0; i < list.length; i++) {\n        if (fn === list[i]) {\n          list.splice(i, 1)\n          if (!list.length) {\n            delete this._events[eventName]\n          }\n          break\n        }\n      }\n    }\n    return this\n  }\n\n  /**\n   * Synchronously calls each of the listeners registered for the event named eventName,\n   * in the order they were registered, passing the supplied arguments to each.\n   *\n   * to break the calls, just return false on listener function.\n   * ```javascript\n   * // es6\n   * let eventEmitter = new EventEmitter();\n   * eventEmitter.on('test', (info) => {\n     *      // this will be called\n     *      console.log(info);\n     * });\n   * eventEmitter.on('test', (info) => {\n     *      // this will be called\n     *      return false;  // this break the calls\n     * });\n   * eventEmitter.on('test', (info) => {\n     *      // this will not be called.\n     *      console.log(info);\n     * });\n   * eventEmitter.emit('test', 'hello eventEmitter');\n   * ```\n   * tip: use arg1...arg5 instead of arguments for performance consider.\n   *\n   * @param {*} eventName - event name\n   * @param {*} arg1\n   * @param {*} arg2\n   * @param {*} arg3\n   * @param {*} arg4\n   * @param {*} arg5\n   * @return {EventEmitter} - for chaining\n   */\n  emit (eventName, ...args) {\n    // using a copy to avoid error when listener array changed\n    let listeners = this.listeners(eventName)\n    for (let i = 0; i < listeners.length; i++) {\n      let fn = listeners[i]\n      let obj = fn(...args)\n      if (!!obj && (typeof obj === 'object' || typeof obj === 'function') && typeof obj.then === 'function') {\n      } else {\n        if (obj !== undefined) return obj\n      }\n    }\n  }\n\n  /**\n   * Returns an array listing the events for which the emitter has registered listeners.\n   * The values in the array will be strings or Symbols.\n   * @return {Array}\n   */\n  eventNames () {\n    return Object.keys(this._events)\n  }\n\n  /**\n   * Returns a copy of the array of listeners for the event named eventName.\n   * @param {*} eventName - event name\n   * @return {Array} - listener array\n   */\n  listeners (eventName) {\n    let v = this._events[eventName]\n    if (!v) return []\n    let listeners = new Array(v.length)\n    for (let i = 0; i < v.length; i++) {\n      listeners[i] = v[i]\n    }\n    return listeners\n  }\n}\n\nlet prototype = EventEmitter.prototype\nlet EM = {\n  _events: {},\n  on: prototype.on,\n  once: prototype.once,\n  off: prototype.off,\n  emit: prototype.emit,\n  eventNames: prototype.eventNames,\n  listeners: prototype.listeners\n}\n\nlet enableEvent = (obj, opts = {}) => {\n  if (obj.emit !== undefined && !opts.force) return false\n  let _events = null\n  if (obj.emit !== undefined) {\n    _events = obj._events\n  }\n  for (let key in EM) {\n    obj[key] = EM[key]\n  }\n  obj._events = _events || {}\n  if (opts.clean && _events) obj._events = {}\n  if (opts.async) obj.emit = emitAsync\n  return true\n}\n\nlet disableEvent = (obj) => {\n  if (obj.emit === undefined) return\n  for (let key in EM) {\n    delete obj[key]\n  }\n}\n\nlet $ = {\n  EventEmitter: EventEmitter,\n  enableEvent: enableEvent,\n  disableEvent: disableEvent\n}\n\nmodule.exports = $\n"],"names":["Promise","reject","callback","e","state","pact","value","observer","emitAsync","eventName","args","listeners","i","length","fn","obj","then","undefined","EventEmitter","opts","_events","async","emit","prepend","unshift","push","on","arg1","arg2","arg3","arg4","arg5","off","list","splice","Object","keys","v","Array","prototype","EM","once","eventNames","enableEvent","force","key","clean","disableEvent","$"],"mappings":"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"}
{"version":3,"file":"jm-event.js","sources":["../lib/index.js"],"sourcesContent":["/**\n * event module.\n * @module event\n */\n\nasync function emitAsync (eventName, ...args) {\n  // using a copy to avoid error when listener array changed\n  let listeners = this.listeners(eventName)\n  for (let i = 0; i < listeners.length; i++) {\n    let fn = listeners[i]\n    let obj = fn(...args)\n    if (!!obj && (typeof obj === 'object' || typeof obj === 'function') && typeof obj.then === 'function') obj = await obj\n    if (obj !== undefined) return obj\n  }\n}\n\n/**\n * Class representing an eventEmitter.\n *\n * ```javascript\n * // es6\n * let eventEmitter = new EventEmitter();\n * eventEmitter.on('test', (info) => {\n *      console.log(info);\n * });\n * eventEmitter.once('test', (info) => {\n *      // this will be called only one time\n *      console.log(info);\n * });\n * eventEmitter.one('test', (info) => {\n *      // this will be called first\n *      console.log(info);\n * }, true);\n *\n * eventEmitter.emit('test', 'hello eventEmitter');\n * eventEmitter.off('test');\n * ```\n */\nclass EventEmitter {\n  /**\n   * Create an eventEmitter.\n   */\n  constructor (opts = {}) {\n    this._events = {}\n    if (opts.async) this.emit = emitAsync\n  }\n\n  /**\n   * Adds the listener function to the end of the listeners array for the event named eventName.\n   * No checks are made to see if the listener has already been added.\n   * Multiple calls passing the same combination of eventName and listener will result in the listener being added, and called, multiple times.\n   *\n   * @param {*} eventName - event name\n   * @param {Function} fn - listener function\n   * @param {boolean} [prepend] - Adds to the beginning of the listeners array if true\n   * @return {EventEmitter} - for chaining\n   */\n  on (eventName, fn, prepend) {\n    this._events[eventName] || (this._events[eventName] = [])\n    if (prepend) {\n      this._events[eventName].unshift(fn)\n    } else {\n      this._events[eventName].push(fn)\n    }\n    return this\n  }\n\n  /**\n   * Adds a one time listener function for the event named eventName.\n   * The next time eventName is triggered, this listener is removed and then invoked.\n   *\n   * @param {*} eventName - event name\n   * @param {Function} fn - listener function\n   * @param {boolean} [prepend] - Adds to the beginning of the listeners array if true\n   * @return {EventEmitter} - for chaining\n   */\n  once (eventName, fn, prepend) {\n    let on = (arg1, arg2, arg3, arg4, arg5) => {\n      this.off(eventName, on)\n      fn(arg1, arg2, arg3, arg4, arg5)\n    }\n    return this.on(eventName, on, prepend)\n  }\n\n  /**\n   * Removes a listener for the event named eventName.\n   * Removes all listeners from the listener array for event named eventName if fn is null\n   * Removes all listeners from the listener array if eventName is null\n   *\n   * @param {*} [eventName] - event name\n   * @param {Function} [fn] - listener function\n   * @return {EventEmitter} - for chaining\n   */\n  off (eventName, fn) {\n    if (!fn) {\n      if (eventName === undefined) {\n        this._events = {}\n      } else if (this._events && this._events[eventName]) {\n        delete this._events[eventName]\n      }\n    } else if (this._events && this._events[eventName]) {\n      let list = this._events[eventName]\n      for (let i = 0; i < list.length; i++) {\n        if (fn === list[i]) {\n          list.splice(i, 1)\n          if (!list.length) {\n            delete this._events[eventName]\n          }\n          break\n        }\n      }\n    }\n    return this\n  }\n\n  /**\n   * Synchronously calls each of the listeners registered for the event named eventName,\n   * in the order they were registered, passing the supplied arguments to each.\n   *\n   * to break the calls, just return false on listener function.\n   * ```javascript\n   * // es6\n   * let eventEmitter = new EventEmitter();\n   * eventEmitter.on('test', (info) => {\n     *      // this will be called\n     *      console.log(info);\n     * });\n   * eventEmitter.on('test', (info) => {\n     *      // this will be called\n     *      return false;  // this break the calls\n     * });\n   * eventEmitter.on('test', (info) => {\n     *      // this will not be called.\n     *      console.log(info);\n     * });\n   * eventEmitter.emit('test', 'hello eventEmitter');\n   * ```\n   * tip: use arg1...arg5 instead of arguments for performance consider.\n   *\n   * @param {*} eventName - event name\n   * @param {*} arg1\n   * @param {*} arg2\n   * @param {*} arg3\n   * @param {*} arg4\n   * @param {*} arg5\n   * @return {EventEmitter} - for chaining\n   */\n  emit (eventName, ...args) {\n    // using a copy to avoid error when listener array changed\n    let listeners = this.listeners(eventName)\n    for (let i = 0; i < listeners.length; i++) {\n      let fn = listeners[i]\n      let obj = fn(...args)\n      if (!!obj && (typeof obj === 'object' || typeof obj === 'function') && typeof obj.then === 'function') {\n      } else {\n        if (obj !== undefined) return obj\n      }\n    }\n  }\n\n  /**\n   * Returns an array listing the events for which the emitter has registered listeners.\n   * The values in the array will be strings or Symbols.\n   * @return {Array}\n   */\n  eventNames () {\n    return Object.keys(this._events)\n  }\n\n  /**\n   * Returns a copy of the array of listeners for the event named eventName.\n   * @param {*} eventName - event name\n   * @return {Array} - listener array\n   */\n  listeners (eventName) {\n    let v = this._events[eventName]\n    if (!v) return []\n    let listeners = new Array(v.length)\n    for (let i = 0; i < v.length; i++) {\n      listeners[i] = v[i]\n    }\n    return listeners\n  }\n}\n\nlet prototype = EventEmitter.prototype\nlet EM = {\n  _events: {},\n  on: prototype.on,\n  once: prototype.once,\n  off: prototype.off,\n  emit: prototype.emit,\n  eventNames: prototype.eventNames,\n  listeners: prototype.listeners\n}\n\nlet enableEvent = (obj, opts = {}) => {\n  if (obj.emit !== undefined && !opts.force) return false\n  let _events = null\n  if (obj.emit !== undefined) {\n    _events = obj._events\n  }\n  for (let key in EM) {\n    obj[key] = EM[key]\n  }\n  obj._events = _events || {}\n  if (opts.async) obj.emit = emitAsync\n  return true\n}\n\nlet disableEvent = (obj) => {\n  if (obj.emit === undefined) return\n  for (let key in EM) {\n    delete obj[key]\n  }\n}\n\nlet $ = {\n  EventEmitter: EventEmitter,\n  enableEvent: enableEvent,\n  disableEvent: disableEvent\n}\n\nmodule.exports = $\n"],"names":["isNaN","apply","f","Promise","resolve","arguments","e","reject","args","i","length","test","update","body","stage","shouldContinue","__value","result","then","__state","updateValue","pact","bind","_resumeAfterTest","_resumeAfterBody","_resumeAfterUpdate","value","thenable","prototype","onFulfilled","onRejected","state","callback","__observer","_this","observer","direct","emitAsync","eventName","listeners","fn","obj","undefined","EventEmitter","opts","_events","async","emit","prepend","unshift","push","on","arg1","arg2","arg3","arg4","arg5","off","list","splice","Object","keys","v","Array","EM","once","eventNames","enableEvent","force","key","disableEvent","$","module","exports"],"mappings":"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"}
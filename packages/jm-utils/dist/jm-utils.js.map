{"version":3,"file":"jm-utils.js","sources":["../lib/index.js"],"sourcesContent":["let argsClass = '[object Arguments]'\nlet arrayClass = '[object Array]'\nlet boolClass = '[object Boolean]'\nlet dateClass = '[object Date]'\nlet funcClass = '[object Function]'\nlet numberClass = '[object Number]'\nlet objectClass = '[object Object]'\nlet regexpClass = '[object RegExp]'\nlet stringClass = '[object String]'\n\n/** Used to identify object classifications that `cloneDeep` supports */\nlet cloneableClasses = {}\ncloneableClasses[funcClass] = false\ncloneableClasses[argsClass] = true\ncloneableClasses[arrayClass] = true\ncloneableClasses[boolClass] = true\ncloneableClasses[dateClass] = true\ncloneableClasses[numberClass] = true\ncloneableClasses[objectClass] = true\ncloneableClasses[regexpClass] = true\ncloneableClasses[stringClass] = true\n\nlet ctorByClass = {}\nctorByClass[arrayClass] = Array\nctorByClass[boolClass] = Boolean\nctorByClass[dateClass] = Date\nctorByClass[objectClass] = Object\nctorByClass[numberClass] = Number\nctorByClass[regexpClass] = RegExp\nctorByClass[stringClass] = String\n\n/** Used to match regexp flags from their coerced string values */\nlet reFlags = /\\w*$/\n\nlet cloneDeep = function (obj) {\n  if (typeof obj !== 'object' || !obj) return obj\n  if (Array.isArray(obj)) {\n    let ret = []\n    obj.forEach(function (item) {\n      ret.push(cloneDeep(item))\n    })\n    return ret\n  }\n  let className = toString.call(obj)\n  if (!cloneableClasses[className]) {\n    return obj\n  }\n  const Ctor = ctorByClass[className]\n  switch (className) {\n    case boolClass:\n    case dateClass:\n      return new Ctor(+obj)\n\n    case numberClass:\n    case stringClass:\n      return new Ctor(obj)\n\n    case regexpClass:\n      return Ctor(obj.source, reFlags.exec(obj))\n  }\n\n  let ret = {}\n  let keys = Object.keys(obj)\n  keys.forEach(function (key) {\n    ret[key] = cloneDeep(obj[key])\n  })\n  return ret\n}\n\nlet merge = function (obj1, obj2) {\n  if (typeof obj1 !== 'object' || !obj1) return obj1\n  if (Array.isArray(obj1)) {\n    obj2.forEach(function (item) {\n      if (obj1.indexOf(item) === -1) {\n        obj1.push(item)\n      }\n    })\n    return obj1\n  }\n  let keys = Object.keys(obj2)\n  keys.forEach(function (key) {\n    if (obj1[key] && typeof obj1[key] === 'object' && typeof obj2[key] === 'object') {\n      merge(obj1[key], obj2[key])\n    } else {\n      obj1[key] = obj2[key]\n    }\n  })\n  return obj1\n}\n\nlet utils = {\n  // 高效slice\n  slice: (a, start, end) => {\n    start = start || 0\n    end = end || a.length\n    if (start < 0) start += a.length\n    if (end < 0) end += a.length\n    let r = new Array(end - start)\n    for (let i = start; i < end; i++) {\n      r[i - start] = a[i]\n    }\n    return r\n  },\n\n  formatJSON: (obj) => {\n    return JSON.stringify(obj, null, 2)\n  },\n\n  getUriProtocol: function (uri) {\n    if (!uri) return null\n    return uri.substring(0, uri.indexOf(':'))\n  },\n\n  getUriPath: function (uri) {\n    let idx = uri.indexOf('//')\n    if (idx === -1) return ''\n    idx = uri.indexOf('/', idx + 2)\n    if (idx === -1) return ''\n    uri = uri.substr(idx)\n    idx = uri.indexOf('#')\n    if (idx === -1) idx = uri.indexOf('?')\n    if (idx !== -1) uri = uri.substr(0, idx)\n    return uri\n  },\n\n  cloneDeep,\n\n  merge\n}\n\nconst moduleUtils = function (name = 'utils') {\n  let app = this\n  app[name] = utils\n\n  return {\n    name: name,\n    unuse: function () {\n      delete app[name]\n    }\n  }\n}\n\nconst $ = {\n  utils: utils,\n  moduleUtils: moduleUtils\n}\n\nmodule.exports = $\n"],"names":["argsClass","arrayClass","boolClass","dateClass","funcClass","numberClass","objectClass","regexpClass","stringClass","cloneableClasses","ctorByClass","Array","Boolean","Date","Object","Number","RegExp","String","reFlags","cloneDeep","obj","isArray","ret","forEach","item","push","className","toString","call","Ctor","source","exec","keys","key","merge","obj1","obj2","indexOf","utils","slice","a","start","end","length","r","i","formatJSON","JSON","stringify","getUriProtocol","uri","substring","getUriPath","idx","substr","moduleUtils","name","app","unuse","$"],"mappings":";;;;;;;;;;;;;;;;;;;;EAAA,IAAIA,SAAS,GAAG,oBAAhB;EACA,IAAIC,UAAU,GAAG,gBAAjB;EACA,IAAIC,SAAS,GAAG,kBAAhB;EACA,IAAIC,SAAS,GAAG,eAAhB;EACA,IAAIC,SAAS,GAAG,mBAAhB;EACA,IAAIC,WAAW,GAAG,iBAAlB;EACA,IAAIC,WAAW,GAAG,iBAAlB;EACA,IAAIC,WAAW,GAAG,iBAAlB;EACA,IAAIC,WAAW,GAAG,iBAAlB;;;EAGA,IAAIC,gBAAgB,GAAG,EAAvB;EACAA,gBAAgB,CAACL,SAAD,CAAhB,GAA8B,KAA9B;EACAK,gBAAgB,CAACT,SAAD,CAAhB,GAA8B,IAA9B;EACAS,gBAAgB,CAACR,UAAD,CAAhB,GAA+B,IAA/B;EACAQ,gBAAgB,CAACP,SAAD,CAAhB,GAA8B,IAA9B;EACAO,gBAAgB,CAACN,SAAD,CAAhB,GAA8B,IAA9B;EACAM,gBAAgB,CAACJ,WAAD,CAAhB,GAAgC,IAAhC;EACAI,gBAAgB,CAACH,WAAD,CAAhB,GAAgC,IAAhC;EACAG,gBAAgB,CAACF,WAAD,CAAhB,GAAgC,IAAhC;EACAE,gBAAgB,CAACD,WAAD,CAAhB,GAAgC,IAAhC;EAEA,IAAIE,WAAW,GAAG,EAAlB;EACAA,WAAW,CAACT,UAAD,CAAX,GAA0BU,KAA1B;EACAD,WAAW,CAACR,SAAD,CAAX,GAAyBU,OAAzB;EACAF,WAAW,CAACP,SAAD,CAAX,GAAyBU,IAAzB;EACAH,WAAW,CAACJ,WAAD,CAAX,GAA2BQ,MAA3B;EACAJ,WAAW,CAACL,WAAD,CAAX,GAA2BU,MAA3B;EACAL,WAAW,CAACH,WAAD,CAAX,GAA2BS,MAA3B;EACAN,WAAW,CAACF,WAAD,CAAX,GAA2BS,MAA3B;;;EAGA,IAAIC,OAAO,GAAG,MAAd;;EAEA,IAAIC,SAAS,GAAG,SAAZA,SAAY,CAAUC,GAAV,EAAe;EAC7B,MAAI,QAAOA,GAAP,MAAe,QAAf,IAA2B,CAACA,GAAhC,EAAqC,OAAOA,GAAP;;EACrC,MAAIT,KAAK,CAACU,OAAN,CAAcD,GAAd,CAAJ,EAAwB;EACtB,QAAIE,IAAG,GAAG,EAAV;EACAF,IAAAA,GAAG,CAACG,OAAJ,CAAY,UAAUC,IAAV,EAAgB;EAC1BF,MAAAA,IAAG,CAACG,IAAJ,CAASN,SAAS,CAACK,IAAD,CAAlB;EACD,KAFD;EAGA,WAAOF,IAAP;EACD;;EACD,MAAII,SAAS,GAAGC,QAAQ,CAACC,IAAT,CAAcR,GAAd,CAAhB;;EACA,MAAI,CAACX,gBAAgB,CAACiB,SAAD,CAArB,EAAkC;EAChC,WAAON,GAAP;EACD;;EACD,MAAMS,IAAI,GAAGnB,WAAW,CAACgB,SAAD,CAAxB;;EACA,UAAQA,SAAR;EACE,SAAKxB,SAAL;EACA,SAAKC,SAAL;EACE,aAAO,IAAI0B,IAAJ,CAAS,CAACT,GAAV,CAAP;;EAEF,SAAKf,WAAL;EACA,SAAKG,WAAL;EACE,aAAO,IAAIqB,IAAJ,CAAST,GAAT,CAAP;;EAEF,SAAKb,WAAL;EACE,aAAOsB,IAAI,CAACT,GAAG,CAACU,MAAL,EAAaZ,OAAO,CAACa,IAAR,CAAaX,GAAb,CAAb,CAAX;EAVJ;;EAaA,MAAIE,GAAG,GAAG,EAAV;EACA,MAAIU,IAAI,GAAGlB,MAAM,CAACkB,IAAP,CAAYZ,GAAZ,CAAX;EACAY,EAAAA,IAAI,CAACT,OAAL,CAAa,UAAUU,GAAV,EAAe;EAC1BX,IAAAA,GAAG,CAACW,GAAD,CAAH,GAAWd,SAAS,CAACC,GAAG,CAACa,GAAD,CAAJ,CAApB;EACD,GAFD;EAGA,SAAOX,GAAP;EACD,CAjCD;;EAmCA,IAAIY,KAAK,GAAG,SAARA,KAAQ,CAAUC,IAAV,EAAgBC,IAAhB,EAAsB;EAChC,MAAI,QAAOD,IAAP,MAAgB,QAAhB,IAA4B,CAACA,IAAjC,EAAuC,OAAOA,IAAP;;EACvC,MAAIxB,KAAK,CAACU,OAAN,CAAcc,IAAd,CAAJ,EAAyB;EACvBC,IAAAA,IAAI,CAACb,OAAL,CAAa,UAAUC,IAAV,EAAgB;EAC3B,UAAIW,IAAI,CAACE,OAAL,CAAab,IAAb,MAAuB,CAAC,CAA5B,EAA+B;EAC7BW,QAAAA,IAAI,CAACV,IAAL,CAAUD,IAAV;EACD;EACF,KAJD;EAKA,WAAOW,IAAP;EACD;;EACD,MAAIH,IAAI,GAAGlB,MAAM,CAACkB,IAAP,CAAYI,IAAZ,CAAX;EACAJ,EAAAA,IAAI,CAACT,OAAL,CAAa,UAAUU,GAAV,EAAe;EAC1B,QAAIE,IAAI,CAACF,GAAD,CAAJ,IAAa,QAAOE,IAAI,CAACF,GAAD,CAAX,MAAqB,QAAlC,IAA8C,QAAOG,IAAI,CAACH,GAAD,CAAX,MAAqB,QAAvE,EAAiF;EAC/EC,MAAAA,KAAK,CAACC,IAAI,CAACF,GAAD,CAAL,EAAYG,IAAI,CAACH,GAAD,CAAhB,CAAL;EACD,KAFD,MAEO;EACLE,MAAAA,IAAI,CAACF,GAAD,CAAJ,GAAYG,IAAI,CAACH,GAAD,CAAhB;EACD;EACF,GAND;EAOA,SAAOE,IAAP;EACD,CAnBD;;EAqBA,IAAIG,KAAK,GAAG;;EAEVC,EAAAA,KAAK,EAAE,eAACC,CAAD,EAAIC,KAAJ,EAAWC,GAAX,EAAmB;EACxBD,IAAAA,KAAK,GAAGA,KAAK,IAAI,CAAjB;EACAC,IAAAA,GAAG,GAAGA,GAAG,IAAIF,CAAC,CAACG,MAAf;EACA,QAAIF,KAAK,GAAG,CAAZ,EAAeA,KAAK,IAAID,CAAC,CAACG,MAAX;EACf,QAAID,GAAG,GAAG,CAAV,EAAaA,GAAG,IAAIF,CAAC,CAACG,MAAT;EACb,QAAIC,CAAC,GAAG,IAAIjC,KAAJ,CAAU+B,GAAG,GAAGD,KAAhB,CAAR;;EACA,SAAK,IAAII,CAAC,GAAGJ,KAAb,EAAoBI,CAAC,GAAGH,GAAxB,EAA6BG,CAAC,EAA9B,EAAkC;EAChCD,MAAAA,CAAC,CAACC,CAAC,GAAGJ,KAAL,CAAD,GAAeD,CAAC,CAACK,CAAD,CAAhB;EACD;;EACD,WAAOD,CAAP;EACD,GAZS;EAcVE,EAAAA,UAAU,EAAE,oBAAC1B,GAAD,EAAS;EACnB,WAAO2B,IAAI,CAACC,SAAL,CAAe5B,GAAf,EAAoB,IAApB,EAA0B,CAA1B,CAAP;EACD,GAhBS;EAkBV6B,EAAAA,cAAc,EAAE,wBAAUC,GAAV,EAAe;EAC7B,QAAI,CAACA,GAAL,EAAU,OAAO,IAAP;EACV,WAAOA,GAAG,CAACC,SAAJ,CAAc,CAAd,EAAiBD,GAAG,CAACb,OAAJ,CAAY,GAAZ,CAAjB,CAAP;EACD,GArBS;EAuBVe,EAAAA,UAAU,EAAE,oBAAUF,GAAV,EAAe;EACzB,QAAIG,GAAG,GAAGH,GAAG,CAACb,OAAJ,CAAY,IAAZ,CAAV;EACA,QAAIgB,GAAG,KAAK,CAAC,CAAb,EAAgB,OAAO,EAAP;EAChBA,IAAAA,GAAG,GAAGH,GAAG,CAACb,OAAJ,CAAY,GAAZ,EAAiBgB,GAAG,GAAG,CAAvB,CAAN;EACA,QAAIA,GAAG,KAAK,CAAC,CAAb,EAAgB,OAAO,EAAP;EAChBH,IAAAA,GAAG,GAAGA,GAAG,CAACI,MAAJ,CAAWD,GAAX,CAAN;EACAA,IAAAA,GAAG,GAAGH,GAAG,CAACb,OAAJ,CAAY,GAAZ,CAAN;EACA,QAAIgB,GAAG,KAAK,CAAC,CAAb,EAAgBA,GAAG,GAAGH,GAAG,CAACb,OAAJ,CAAY,GAAZ,CAAN;EAChB,QAAIgB,GAAG,KAAK,CAAC,CAAb,EAAgBH,GAAG,GAAGA,GAAG,CAACI,MAAJ,CAAW,CAAX,EAAcD,GAAd,CAAN;EAChB,WAAOH,GAAP;EACD,GAjCS;EAmCV/B,EAAAA,SAAS,EAATA,SAnCU;EAqCVe,EAAAA,KAAK,EAALA;EArCU,CAAZ;;EAwCA,IAAMqB,WAAW,GAAG,SAAdA,WAAc,GAA0B;EAAA,MAAhBC,IAAgB,uEAAT,OAAS;EAC5C,MAAIC,GAAG,GAAG,IAAV;EACAA,EAAAA,GAAG,CAACD,IAAD,CAAH,GAAYlB,KAAZ;EAEA,SAAO;EACLkB,IAAAA,IAAI,EAAEA,IADD;EAELE,IAAAA,KAAK,EAAE,iBAAY;EACjB,aAAOD,GAAG,CAACD,IAAD,CAAV;EACD;EAJI,GAAP;EAMD,CAVD;;EAYA,IAAMG,CAAC,GAAG;EACRrB,EAAAA,KAAK,EAAEA,KADC;EAERiB,EAAAA,WAAW,EAAEA;EAFL,CAAV;EAKA,OAAc,GAAGI,CAAjB;;;;;;;;;;;;"}